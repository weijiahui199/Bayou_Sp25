cost.per.year.mat[,4]<-(12000/dfm$mpg[dfm$name=="Toyota Corolla"])*cost.per.year.mat[,2]
Cost<-as.data.frame(cost.per.year.mat)
colors<-c("Camaro Z28"="red", "Toyota Corolla"="blue")
ggplot(data=Cost, mapping=aes(x=Year))+
geom_line(aes(y=CamaroZ28Cost,color="Camaro Z28"))+
geom_point(aes(y=CamaroZ28Cost, color="Camaro Z28"))+
geom_line(aes(y=ToyotaCorolla, color="Toyota Corolla"))+
geom_point(aes(y=ToyotaCorolla, color="Toyota Corolla"))+
ggtitle("Average Gas Cost per Car by Year")+
labs(x= "Year", y = "Cost to Drive 12,000 Miles per Year", color="Car Type")+
scale_color_manual(values=colors)
install.packages("tidycensus")
install.packages("zipcodeR")
v17 <- load_variables(2017, "acs5", cache = TRUE)
library(tidycensus)
library(tidyverse)
v17 <- load_variables(2017, "acs5", cache = TRUE)
View(v17)
v14 <- load_variables(2014, "acs5", cache = TRUE)
View(v14)
install.packages('leaflet')
install.packages('ggplotly')
library(leaflet)
library(ggplotly)
knitr::opts_chunk$set(echo = TRUE)
#install.packages("tidyverse")
library(tidyverse) #https://www.tidyverse.org/packages/
#install.packages("lubridate")
library(lubridate) #https://lubridate.tidyverse.org/
data <-  read.csv("Practice Data.csv")
setwd("/Users/alexkornblum/downloads")
data <-  read.csv("Practice Data.csv")
data <-  read.csv("Practice Data.csv")
View(data)
head(data) # Loads a few rows and columns of the dataset
sapply(data, class) # Let's examine the classes of all the variables we are working with
head(data) # Loads a few rows and columns of the dataset
sapply(data, class) # Let's examine the classes of all the variables we are working with
## Data Manipulation with Lubridate
Lubridate Cheat Sheet: https://rawgit.com/rstudio/cheatsheets/main/lubridate.pdf
# Let's look at the column types in our dataset
class(data$GIFT_DATE)
data$GIFT_DATE <- ymd(data$GIFT_DATE) # Gives this column the features of a date value
class(data$GIFT_DATE)
class(data$CREATED_DATE)
data$CREATED_DATE <- ymd_hms(data$CREATED_DATE) # Gives this column the features of a POSIXct value; dates and times with control for time zones
class(data$CREATED_DATE)
# Additonal Dates in Dataset to Alter
data$BIRTHDATE <- ymd(data$BIRTHDATE)
data$INITIAL_GIFT_DATE <- ymd(data$INITIAL_GIFT_DATE)
data$LAST_CONTRIB_DATE <- ymd(data$LAST_CONTRIB_DATE)
# SELECT Statement
# Q: Select only the City, State, and Amount Data.
data %>%
select (city, state, AMOUNT)
# FILTER Statement
# Q: Look at observations only if initial donation is before June 12, 2015
data %>%
filter (INITIAL_GIFT_DATE <= "2015-06-12")
# GROUP BY Statement
# Q: Find the number of observations by State
data %>%
group_by(state) %>%
summarise(total=n())
# MUTATE Statement
data %>%
mutate(fraction = AMOUNT/LAST_CONTRIB_AMT)
# Adding in Information for Donor Retention
data.new <- data %>%
group_by(DONOR_ID) %>%
summarize(TOTAL_AMOUNT = sum(AMOUNT), TOTAL_NUMBER = n()) %>%
mutate(RETAINED = ifelse(TOTAL_NUMBER > 1, 1, 0)) %>%
mutate(DONOR_CATEGORY = ifelse(TOTAL_AMOUNT >= 10000, 2, ifelse(TOTAL_AMOUNT < 2500, 0, 1)))
data.new # Print out our new dataframe
data1 <- left_join(data.new, data, by = "DONOR_ID")
data1
data %>%
filter (GL_CODE_DESCR == "walk4ALZ")
data %>%
filter (GL_CODE_DESCR == "walk4ALZ")
filter (AMOUNT >= 150)
data %>%
filter (GL_CODE_DESCR == "walk4ALZ")
View(data)
filter (AMOUNT >= 150)
data %>%
filter (GL_CODE_DESCR == "walk4ALZ") %>%
filter (AMOUNT >= 150) %>%
select (state, AMOUNT, GL_CODE_DESCR, IN_AMT)
# STRING MANIPULATION
# Transform everything into lowercase
str_to_lower(data$city)
# Replace the space in city with a hyphen
str_replace(data$city," ","-")
# REGULAR EXPRESSION
str_extract(data$state, ".A")
# SEPARATE Statement (dplyr) + StringR Use Case
data[1,10] <- c("Online, Mail, Envelope") # Example Case
ncols_donation_types <- max(str_count(data$GL_CODE_DESCR, ", ")) + 1
colmn_donation_types <- paste("Donation Method", 1:ncols_donation_types)
data %>%
separate(GL_CODE_DESCR, sep = ", ", into = colmn_donation_types, remove = FALSE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
```{r, echo= FALSE, results='hide', message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(plotly)
library(stringr)
#Loads in Data (set to your working directory)
Data <- read.csv("PracticeData.csv")
#Loads in Data (set to your working directory)
Data <- read.csv("PracticeData.pdf")
#Loads in Data (set to your working directory)
Data <- read.csv("Practice Data.csv")
#Turns Data into tibble
Data <- as_tibble(Data)
View(Data)
#Turns all data columns into date data format
Data$INITIAL_GIFT_DATE <- as.Date(Data$INITIAL_GIFT_DATE)
Data$CREATED_DATE <- as.Date(Data$CREATED_DATE)
Data$LAST_CONTRIB_DATE <- as.Date(Data$LAST_CONTRIB_DATE)
Data$BIRTHDATE <- as.Date(Data$BIRTHDATE)
Data$GIFT_DATE <- as.Date(Data$GIFT_DATE)
#Organizes the Gift Date column from most recent to most earliest date
DataDates <- Data[order(Data$GIFT_DATE,decreasing = 'T'),]
### 2016-2017 ###
#uses stringR to filter the first any dates between July 2016 and June 2017 (1 fiscal year)
firstyear <- Data %>% filter(str_detect(GIFT_DATE,"2016|2017")) %>%
filter(str_detect(GIFT_DATE,"2016-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2017-(0[1-6])"))
firstyear <- firstyear[order(firstyear$GIFT_DATE,decreasing ='T'),]
View(firstyear)
### 2017-2018 ###
secondyear <- Data %>% filter(str_detect(GIFT_DATE,"2017|2018")) %>%
filter(str_detect(GIFT_DATE,"2017-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2018-(0[1-6])"))
secondyear <- secondyear[order(secondyear$GIFT_DATE,decreasing ='T'),]
### 2018 - 2019 ###
thirdyear <- Data %>% filter(str_detect(GIFT_DATE,"2018|2019")) %>%
filter(str_detect(GIFT_DATE,"2018-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2019-(0[1-6])"))
thirdyear <- thirdyear[order(thirdyear$GIFT_DATE,decreasing ='T'),]
### 2019 - 2020 ###
fourthyear <- Data %>% filter(str_detect(GIFT_DATE,"2019|2020")) %>%
filter(str_detect(GIFT_DATE,"2019-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2020-(0[1-6])"))
fourthyear <- fourthyear[order(fourthyear$GIFT_DATE,decreasing ='T'),]
### 2020 - 2021 ###
fifthyear <- Data %>% filter(str_detect(GIFT_DATE,"2020|2021")) %>%
filter(str_detect(GIFT_DATE,"2020-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2021-(0[1-6])"))
fifthyear <- fifthyear[order(fifthyear$GIFT_DATE,decreasing ='T'),]
### 2021 - 2022 ###
sixthyear <- Data %>% filter(str_detect(GIFT_DATE,"2021|2022")) %>%
filter(str_detect(GIFT_DATE,"2021-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2022-(0[1-6])"))
sixthyear <- sixthyear[order(sixthyear$GIFT_DATE,decreasing ='T'),]
#sums all the donations for each campaign for the given fiscal year
a <- firstyear %>%
group_by(GL_CODE_DESCR) %>% #groups by campaigns
summarise(Total = round(sum(AMOUNT),2)) %>% #finds the sum of values in column "AMOUNT" for every campaign
add_column(Year = '2016-2017',.before = 'Total') #adds column with the year to the subset
b <- secondyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2017-2018',.before = 'Total')
c <- thirdyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2018-2019',.before = 'Total')
d <- fourthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2019-2020',.before = 'Total')
e <- fifthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2020-2021',.before = 'Total')
f <- sixthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2021-2022',.before = 'Total')
meanDonations <- rbind(a,b,c,d,e,f) %>% #binds the subsets together by row
rename(Campaign = GL_CODE_DESCR) %>% #renames column name
arrange(Campaign) #orders campaigns alphabetically
#filters meanDonations to only include fiscal years with data points
grThan1 <- meanDonations %>% group_by(Campaign) %>% filter(n() > 1)
ggplot(grThan1) + #sets data table
aes(Year,Total) + #x-axis = column Year, y-axis = column Total
geom_point() + #point plot
geom_path(aes(group=1)) + #connects the points with a line
facet_wrap(~ Campaign, #creates a separate plot for every campaign
scales='free') + #no shared axis
ylab('Total Donation ($)') + #y-axis label
xlab('Fiscal Year') + #x-axis label
ggtitle('Total Amount Donated to Every Campaign From 2016-2022') + #plot title
theme(axis.title = element_text(size=20), #axis titles text size
plot.title = element_text(size = 25,hjust=0.5), #individual plot title sizes
axis.text.x = element_text(size = 10, #size of fiscal year labels on x-axis
angle = 45, #angle of x-axis labels
hjust=1)) #right-justified (just do this always)
a <- firstyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2016-2017',.before = 'Sum')
b <- secondyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2017-2018',.before = 'Sum')
c <- thirdyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2018-2019',.before = 'Sum')
d <- fourthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2019-2020',.before = 'Sum')
e <- fifthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2020-2021',.before = 'Sum')
f <- sixthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2021-2022',.before = 'Sum')
camp <- rbind(a,b,c,d,e,f)
arrangedcamp <- camp %>% arrange(GL_CODE_DESCR) %>% rename(Campaign = GL_CODE_DESCR)
p <- ggplot(arrangedcamp) +
aes(Year, Sum, fill = Campaign) + #x-axis = Year, y-axis = Sum, fill bars with Campaigns
geom_bar(stat="identity", #skips R doing the value aggregation
color='black') + #outlines part of the bar in black
xlab('Year') + ylab('Total Gift Amount ($)') + #x-axis, y-axis
scale_y_continuous(labels=function(x) format(x, big.mark = ",", scientific = FALSE)) + #removes scientific notation on y-axis labels
ggtitle('Total Amount Donated to Every Campaign From 2016-2022') + #title
theme(plot.title = element_text(size = 16,hjust=0.5)) #changes plot title size and centers it
#makes ggplot interactive using plotly package
giftAmount <- ggplotly(p)
giftAmount
Donation_type <- Data %>% group_by(GL_CODE_DESCR,RECORD_TYPE_DESCR) %>% summarise(Mean=round(mean(AMOUNT),2))
ggplot(Donation_type) + aes(RECORD_TYPE_DESCR, Mean, fill = GL_CODE_DESCR) + geom_bar(stat="identity",color='black') + xlab('Donation Type') + ylab('Mean Gift Amount ($)') + ggtitle('Mean Amount Donated to Every Campaign By Donation Type') + theme(plot.title = element_text(size = 16,hjust=0.5))
library(tidyverse)
library(dplyr)
library(ggplot2)
data <- read.csv("Practice Data.csv")
# getting rid of the numbers after the "-" in the zipcode
data <- data %>%
mutate(zip = parse_number(zip)) %>%
transform(zip = str_sub(zip, 1, 5)) %>%
mutate(zip = as.numeric(zip))
# getting rid of the numbers after the "-" in the zipcode
data <- data %>%
mutate(zip = parse_number(zip)) %>%
transform(zip = str_sub(zip, 1, 5)) %>%
mutate(zip = as.numeric(zip))
# getting rid of the numbers after the "-" in the zipcode
data <- data %>%
mutate(zip = parse_number(zip)) %>%
transform(zip = str_sub(zip, 1, 5)) %>%
mutate(zip = as.numeric(zip))
# package to convert zipcode into latitude and longitude coordinates
library(zipcodeR)
# getting latitude and longitude coordinates for zipcode
coord <- geocode_zip(data$zip)
coord <- coord %>%
mutate(Latitude = as.numeric(lat)) %>%
mutate(Longitude = as.numeric(lng)) %>%
mutate(zip = as.numeric(zipcode)) %>%
dplyr::select(zip, Latitude, Longitude)
data <- left_join(data, coord, by = "zip")
# dropping NAs (if you have NA, the mapview function will not work)
data <- data %>%
drop_na(Latitude) %>%
drop_na(Longitude)
# package to create maps
library(mapview)
# CRS = 4326 is a GPS coordinate system
mapview(data, "Longitude", "Latitude", crs = 4326)
# Zcol to introduce color
mapview(data, "Longitude", "Latitude", crs = 4326, zcol = "RECORD_TYPE_DESCR")
#install.packages("tidyverse")
library(tidyverse) #https://www.tidyverse.org/packages/
#install.packages("tidyverse")
library(tidyverse) #https://www.tidyverse.org/packages/
#install.packages("lubridate")
library(lubridate) #https://lubridate.tidyverse.org/
setwd("/Users/alexkornblum/downloads")
setwd("/Users/alexkornblum/downloads")
data <-  read.csv("Practice Data.csv")
View(data)
View(data)
head(data) # Loads a few rows and columns of the dataset
sapply(data, class) # Let's examine the classes of all the variables we are working with
# Let's look at the column types in our dataset
class(data$GIFT_DATE)
data$GIFT_DATE <- ymd(data$GIFT_DATE) # Gives this column the features of a date value
data$GIFT_DATE <- ymd(data$GIFT_DATE) # Gives this column the features of a date value
class(data$GIFT_DATE)
class(data$CREATED_DATE)
data$CREATED_DATE <- ymd_hms(data$CREATED_DATE) # Gives this column the features of a POSIXct value; dates and times with control for time zones
class(data$CREATED_DATE)
# Additonal Dates in Dataset to Alter
data$BIRTHDATE <- ymd(data$BIRTHDATE)
data$LAST_CONTRIB_DATE <- ymd(data$LAST_CONTRIB_DATE)
# SELECT Statement
# Q: Select only the City, State, and Amount Data.
data %>%
select (city, state, AMOUNT)
# FILTER Statement
# Q: Look at observations only if initial donation is before June 12, 2015
data %>%
filter (INITIAL_GIFT_DATE <= "2015-06-12")
# GROUP BY Statement
# Q: Find the number of observations by State
data %>%
group_by(state) %>%
summarise(total=n())
# MUTATE Statement
data %>%
mutate(fraction = AMOUNT/LAST_CONTRIB_AMT)
# Adding in Information for Donor Retention
data.new <- data %>%
group_by(DONOR_ID) %>%
summarize(TOTAL_AMOUNT = sum(AMOUNT), TOTAL_NUMBER = n()) %>%
mutate(RETAINED = ifelse(TOTAL_NUMBER > 1, 1, 0)) %>%
mutate(DONOR_CATEGORY = ifelse(TOTAL_AMOUNT >= 10000, 2, ifelse(TOTAL_AMOUNT < 2500, 0, 1)))
data.new # Print out our new dataframe
data1 <- left_join(data.new, data, by = "DONOR_ID")
data1
# SELECT Statement
# Q: Select only the City, State, and Amount Data.
data %>%
select (city, state, AMOUNT)
# FILTER Statement
# Q: Look at observations only if initial donation is before June 12, 2015
data %>%
filter (INITIAL_GIFT_DATE <= "2015-06-12")
# GROUP BY Statement
# Q: Find the number of observations by State
data %>%
group_by(state) %>%
summarise(total=n())
# MUTATE Statement
data %>%
mutate(fraction = AMOUNT/LAST_CONTRIB_AMT)
data %>%
filter (GL_CODE_DESCR == "walk4ALZ") %>%
filter (AMOUNT >= 150) %>%
select (state, AMOUNT, GL_CODE_DESCR, IN_AMT)
data %>%
select (state, AMOUNT, GL_CODE_DESCR, IN_AMT) %>%
filter (GL_CODE_DESCR == "walk4ALZ") %>%
filter (AMOUNT >= 150)
# STRING MANIPULATION
# Transform everything into lowercase
str_to_lower(data$city)
# Replace the space in city with a hyphen
str_replace(data$city," ","-")
# REGULAR EXPRESSION
str_extract(data$state, ".A")
# SEPARATE Statement (dplyr) + StringR Use Case
data[1,10] <- c("Online, Mail, Envelope") # Example Case
# SEPARATE Statement (dplyr) + StringR Use Case
data[1,10] <- c("Online, Mail, Envelope") # Example Case
# STRING MANIPULATION
# Transform everything into lowercase
str_to_lower(data$city)
# Replace the space in city with a hyphen
str_replace(data$city," ","-")
# REGULAR EXPRESSION
str_extract(data$state, ".A")
# SEPARATE Statement (dplyr) + StringR Use Case
data[1,10] <- c("Online, Mail, Envelope") # Example Case
ncols_donation_types <- max(str_count(data$GL_CODE_DESCR, ", ")) + 1
colmn_donation_types <- paste("Donation Method", 1:ncols_donation_types)
data %>%
separate(GL_CODE_DESCR, sep = ", ", into = colmn_donation_types, remove = FALSE)
ncols_donation_types <- max(str_count(data$GL_CODE_DESCR, ", ")) + 1
colmn_donation_types <- paste("Donation Method", 1:ncols_donation_types)
data %>%
separate(GL_CODE_DESCR, sep = ", ", into = colmn_donation_types, remove = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(plotly)
library(stringr)
#Loads in Data (set to your working directory)
Data <- read.csv("Practice Data.csv")
#Turns Data into tibble
Data <- as_tibble(Data)
#Turns all data columns into date data format
Data$INITIAL_GIFT_DATE <- as.Date(Data$INITIAL_GIFT_DATE)
Data$CREATED_DATE <- as.Date(Data$CREATED_DATE)
Data$LAST_CONTRIB_DATE <- as.Date(Data$LAST_CONTRIB_DATE)
Data$BIRTHDATE <- as.Date(Data$BIRTHDATE)
Data$GIFT_DATE <- as.Date(Data$GIFT_DATE)
#Organizes the Gift Date column from most recent to most earliest date
DataDates <- Data[order(Data$GIFT_DATE,decreasing = 'T'),]
### 2016-2017 ###
#uses stringR to filter the first any dates between July 2016 and June 2017 (1 fiscal year)
firstyear <- Data %>% filter(str_detect(GIFT_DATE,"2016|2017")) %>%
filter(str_detect(GIFT_DATE,"2016-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2017-(0[1-6])"))
firstyear <- firstyear[order(firstyear$GIFT_DATE,decreasing ='T'),]
View(firstyear)
### 2017-2018 ###
secondyear <- Data %>% filter(str_detect(GIFT_DATE,"2017|2018")) %>%
filter(str_detect(GIFT_DATE,"2017-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2018-(0[1-6])"))
secondyear <- secondyear[order(secondyear$GIFT_DATE,decreasing ='T'),]
### 2018 - 2019 ###
thirdyear <- Data %>% filter(str_detect(GIFT_DATE,"2018|2019")) %>%
filter(str_detect(GIFT_DATE,"2018-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2019-(0[1-6])"))
thirdyear <- thirdyear[order(thirdyear$GIFT_DATE,decreasing ='T'),]
### 2019 - 2020 ###
fourthyear <- Data %>% filter(str_detect(GIFT_DATE,"2019|2020")) %>%
filter(str_detect(GIFT_DATE,"2019-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2020-(0[1-6])"))
fourthyear <- fourthyear[order(fourthyear$GIFT_DATE,decreasing ='T'),]
### 2020 - 2021 ###
fifthyear <- Data %>% filter(str_detect(GIFT_DATE,"2020|2021")) %>%
filter(str_detect(GIFT_DATE,"2020-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2021-(0[1-6])"))
fifthyear <- fifthyear[order(fifthyear$GIFT_DATE,decreasing ='T'),]
### 2021 - 2022 ###
sixthyear <- Data %>% filter(str_detect(GIFT_DATE,"2021|2022")) %>%
filter(str_detect(GIFT_DATE,"2021-(0[7-9]|[10-12])") | str_detect(GIFT_DATE,"2022-(0[1-6])"))
sixthyear <- sixthyear[order(sixthyear$GIFT_DATE,decreasing ='T'),]
#sums all the donations for each campaign for the given fiscal year
a <- firstyear %>%
group_by(GL_CODE_DESCR) %>% #groups by campaigns
summarise(Total = round(sum(AMOUNT),2)) %>% #finds the sum of values in column "AMOUNT" for every campaign
add_column(Year = '2016-2017',.before = 'Total') #adds column with the year to the subset
b <- secondyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2017-2018',.before = 'Total')
c <- thirdyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2018-2019',.before = 'Total')
d <- fourthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2019-2020',.before = 'Total')
e <- fifthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2020-2021',.before = 'Total')
f <- sixthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Total = round(sum(AMOUNT),2)) %>% add_column(Year = '2021-2022',.before = 'Total')
meanDonations <- rbind(a,b,c,d,e,f) %>% #binds the subsets together by row
rename(Campaign = GL_CODE_DESCR) %>% #renames column name
arrange(Campaign) #orders campaigns alphabetically
#filters meanDonations to only include fiscal years with data points
grThan1 <- meanDonations %>% group_by(Campaign) %>% filter(n() > 1)
#filters meanDonations to only include fiscal years with data points
grThan1 <- meanDonations %>% group_by(Campaign) %>% filter(n() > 1)
ggplot(grThan1) + #sets data table
aes(Year,Total) + #x-axis = column Year, y-axis = column Total
geom_point() + #point plot
geom_path(aes(group=1)) + #connects the points with a line
facet_wrap(~ Campaign, #creates a separate plot for every campaign
scales='free') + #no shared axis
ylab('Total Donation ($)') + #y-axis label
xlab('Fiscal Year') + #x-axis label
ggtitle('Total Amount Donated to Every Campaign From 2016-2022') + #plot title
theme(axis.title = element_text(size=20), #axis titles text size
plot.title = element_text(size = 25,hjust=0.5), #individual plot title sizes
axis.text.x = element_text(size = 10, #size of fiscal year labels on x-axis
angle = 45, #angle of x-axis labels
hjust=1)) #right-justified (just do this always)
a <- firstyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2016-2017',.before = 'Sum')
b <- secondyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2017-2018',.before = 'Sum')
c <- thirdyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2018-2019',.before = 'Sum')
d <- fourthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2019-2020',.before = 'Sum')
e <- fifthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2020-2021',.before = 'Sum')
f <- sixthyear %>% group_by(GL_CODE_DESCR) %>% summarise(Sum=round(sum(AMOUNT),2)) %>% add_column(Year = '2021-2022',.before = 'Sum')
camp <- rbind(a,b,c,d,e,f)
arrangedcamp <- camp %>% arrange(GL_CODE_DESCR) %>% rename(Campaign = GL_CODE_DESCR)
p <- ggplot(arrangedcamp) +
aes(Year, Sum, fill = Campaign) + #x-axis = Year, y-axis = Sum, fill bars with Campaigns
geom_bar(stat="identity", #skips R doing the value aggregation
color='black') + #outlines part of the bar in black
xlab('Year') + ylab('Total Gift Amount ($)') + #x-axis, y-axis
scale_y_continuous(labels=function(x) format(x, big.mark = ",", scientific = FALSE)) + #removes scientific notation on y-axis labels
ggtitle('Total Amount Donated to Every Campaign From 2016-2022') + #title
theme(plot.title = element_text(size = 16,hjust=0.5)) #changes plot title size and centers it
#makes ggplot interactive using plotly package
giftAmount <- ggplotly(p)
giftAmount
# getting rid of the numbers after the "-" in the zipcode
data <- data %>%
mutate(zip = parse_number(zip)) %>%
transform(zip = str_sub(zip, 1, 5)) %>%
mutate(zip = as.numeric(zip))
# package to convert zipcode into latitude and longitude coordinates
library(zipcodeR)
# getting latitude and longitude coordinates for zipcode
coord <- geocode_zip(data$zip)
coord <- coord %>%
mutate(Latitude = as.numeric(lat)) %>%
mutate(Longitude = as.numeric(lng)) %>%
mutate(zip = as.numeric(zipcode)) %>%
dplyr::select(zip, Latitude, Longitude)
data <- left_join(data, coord, by = "zip")
# dropping NAs (if you have NA, the mapview function will not work)
data <- data %>%
drop_na(Latitude) %>%
drop_na(Longitude)
# package to create maps
library(mapview)
# CRS = 4326 is a GPS coordinate system
mapview(data, "Longitude", "Latitude", crs = 4326)
# Zcol to introduce color
mapview(data, "Longitude", "Latitude", crs = 4326, zcol = "RECORD_TYPE_DESCR")
#clear workspace
dev.off()
cat("\014")
rm(list=ls())
set.seed(18552)
#set working directory
setwd("/Users/alexkornblum/Desktop/dsci/Bayou_Sp25/Modeling/Modeling in R")
#import required packages
library(tidyr)
library(dplyr)
library(lfe)
library(car)
library(ggplot2)
library(lme4)
#import data
rainfall <- read.csv("../../Data/Rainfall Data by Zipcode/monthly_rainfall_by_zipcode.csv")
monthly_private_events <- read.csv("../../Data/Event Count Data by Zipcode/Monthly Event Counts/monthly_private_by_zipcode.csv")
monthly_public_events <- read.csv("../../Data/Event Count Data by Zipcode/Monthly Event Counts/monthly_public_by_zipcode.csv")
#pivot to long data
rainfall_long <- rainfall %>%
pivot_longer(cols = -Zipcode, names_to = "month", values_to = "rainfall")
private_long <- monthly_private_events %>%
pivot_longer(cols = -Zipcode, names_to = "month", values_to = "private_events")
public_long <- monthly_public_events %>%
pivot_longer(cols = -Zipcode, names_to = "month", values_to = "public_events")
#merge events and rainfall
private_events_rainfall <- merge(private_long, rainfall_long, by = c("Zipcode", "month"))
public_events_rainfall <- merge(public_long, rainfall_long, by = c("Zipcode", "month"))
#clean zip code to a factor
private_events_rainfall$Zipcode <- factor(private_events_rainfall$Zipcode)
public_events_rainfall$Zipcode <- factor(public_events_rainfall$Zipcode)
#clean month into an integer
private_events_rainfall$year_part <- as.numeric(sub('X(\\d{4})\\.(\\d{2})', '\\1', private_events_rainfall$month))
private_events_rainfall$month_part <- as.numeric(sub('X\\d{4}\\.(\\d{2})', '\\1', private_events_rainfall$month))
private_events_rainfall$month_cleaned <- (private_events_rainfall$year_part - 2022) * 12 + private_events_rainfall$month_part
#same for public events
public_events_rainfall$year_part <- as.numeric(sub('X(\\d{4})\\.(\\d{2})', '\\1', public_events_rainfall$month))
public_events_rainfall$month_part <- as.numeric(sub('X\\d{4}\\.(\\d{2})', '\\1', public_events_rainfall$month))
public_events_rainfall$month_cleaned <- (public_events_rainfall$year_part - 2022) * 12 + public_events_rainfall$month_part
#removing time trend
mlr_simple <- felm(private_events ~ rainfall | Zipcode | 0 | Zipcode, data = private_events_rainfall)
summary(mlr_simple)
#trying the original model on the public events
mlr_public <- felm(public_events ~ rainfall + month_cleaned | Zipcode | 0 | Zipcode, data = public_events_rainfall)
summary(mlr_public)
#trying the original model on the public events
mlr_public <- lm(public_events ~ rainfall + month_cleaned + factor(Zipcode), data = public_events_rainfall)
summary(mlr_public)
poisson3 <- glm(public_events ~ rainfall + factor(Zipcode), data = public_events_rainfall, family = poisson(link = "log"))
summary(poisson3)
